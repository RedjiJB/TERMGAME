mission:
  id: linux/environment/practice-environment-debugging
  title: 'Practice: Debug Broken Development Environment'
  difficulty: advanced
  description: A developer's environment is misconfigured. Find and fix all issues
    using your environment variable knowledge.
  estimated_time: 45
  tags:
  - linux
  - practice
  - debugging
  - environment
  - expert
environment:
  image: ubuntu:22.04
  workdir: /home/learner
  setup:
  - mkdir -p /home/learner/bin /home/learner/.local/bin /home/learner/tools
  - mkdir -p /home/learner/projects/webapp
  - echo '#!/bin/bash' > /home/learner/bin/deploy
  - echo 'echo Deploying to $DEPLOY_ENV' >> /home/learner/bin/deploy
  - 'echo ''echo Server: $SERVER_URL'' >> /home/learner/bin/deploy'
  - chmod +x /home/learner/bin/deploy
  - echo '#!/bin/bash' > /home/learner/.local/bin/build
  - 'echo ''echo Building project: $PROJECT_NAME'' >> /home/learner/.local/bin/build'
  - 'echo ''echo Output: $BUILD_OUTPUT'' >> /home/learner/.local/bin/build'
  - echo '#!/bin/bash' > /home/learner/tools/test
  - echo 'if [ -z "$TEST_DB" ]; then' >> /home/learner/tools/test
  - 'echo ''  echo ERROR: TEST_DB not set'' >> /home/learner/tools/test'
  - echo '  exit 1' >> /home/learner/tools/test
  - echo 'fi' >> /home/learner/tools/test
  - echo 'echo Running tests against $TEST_DB' >> /home/learner/tools/test
  - chmod +x /home/learner/tools/test
  - cat > /home/learner/.bashrc << 'BASHRC_EOF'
  - '# Development environment'
  - '# BUG 1: Missing export'
  - PROJECT_NAME='webapp'
  - '# BUG 2: Wrong path separator'
  - export PATH='$HOME/bin;$HOME/.local/bin:$PATH'
  - '# BUG 3: Variable not exported'
  - DEPLOY_ENV='development'
  - '# BUG 4: Typo in variable name'
  - export SERVER_URl='localhost:8080'
  - '# BUG 5: Wrong quotes prevent expansion'
  - export BUILD_OUTPUT='$HOME/build'
  - '# BUG 6: Path not included'
  - '# export PATH=''$HOME/tools:$PATH'''
  - BASHRC_EOF
  - cat > /home/learner/REQUIREMENTS.txt << 'EOF'
  - DEVELOPMENT ENVIRONMENT REQUIREMENTS
  - =====================================
  - ''
  - 'The following must work correctly:'
  - ''
  - 1. Command 'deploy' must be available
  - '   - Must show: Deploying to development'
  - '   - Must show: Server: localhost:8080'
  - ''
  - 2. Command 'build' must be available
  - '   - Must show: Building project: webapp'
  - '   - Must show actual path, not literal $HOME'
  - ''
  - 3. Command 'test' must be available and run without errors
  - '   - Requires TEST_DB variable set to ''test_database'''
  - ''
  - 4. Environment must persist across new bash sessions
  - ''
  - 'KNOWN ISSUES:'
  - '- Some scripts can''t be found'
  - '- Some variables show as empty'
  - '- Some variables show literal text instead of expanding'
  - '- ''build'' command gives permission denied'
  - '- ''test'' command requires TEST_DB but it''s not set'
  - EOF
steps:
- id: understand-problem
  title: Read the Requirements
  description: '**PRACTICE SCENARIO - No Step-by-Step Guidance**


    You''ve inherited a broken development environment. Multiple issues prevent

    the scripts from working correctly.


    Read the requirements:

    cat ~/REQUIREMENTS.txt


    Then examine the current configuration:

    cat ~/.bashrc


    **Your Mission:**

    Fix ALL issues so that the environment works as specified.

    You''ll need to:

    - Debug PATH problems

    - Fix variable exports

    - Correct permission issues

    - Fix quoting issues

    - Ensure persistence


    **This is open-ended - solve it your way!**


    When ready, type ''validate'' to check your work.

    '
  hint: Read REQUIREMENTS.txt carefully. Check .bashrc, test each command, fix issues
    systematically.
  validation:
    type: command-output
    command: cat /home/learner/REQUIREMENTS.txt | grep -c 'REQUIREMENTS'
    matcher: contains
    expected: '1'
- id: fix-deploy-command
  title: Deploy Command Must Work
  description: 'The ''deploy'' command should be accessible and show correct output:

    - Deploying to development

    - Server: localhost:8080


    **Challenge:** There are multiple issues preventing this.

    Find and fix them all.


    No hints - use your debugging skills!

    '
  hint: 'Check: Is PATH correct? Are variables exported? Check variable names. Test:
    deploy'
  validation:
    type: command-output
    command: 'source /home/learner/.bashrc && export PATH="$HOME/bin:$HOME/.local/bin:$HOME/tools:$PATH"
      && export DEPLOY_ENV=''development'' && export SERVER_URL=''localhost:8080''
      && deploy

      '
    matcher: contains
    expected: Deploying to development
- id: fix-build-command
  title: Build Command Must Work
  description: 'The ''build'' command should run and show:

    - Building project: webapp

    - Output: /home/learner/build (actual path, not $HOME)


    **Multiple issues to solve:**

    - Command not found?

    - Permission problems?

    - Variable not expanding?

    - Variable not exported?


    Debug and fix!

    '
  hint: Check permissions with ls -l, check variable exports, check quote types
  validation:
    type: command-output
    command: 'chmod +x /home/learner/.local/bin/build && source /home/learner/.bashrc
      && export PATH="$HOME/bin:$HOME/.local/bin:$HOME/tools:$PATH" && export PROJECT_NAME=''webapp''
      && export BUILD_OUTPUT="$HOME/build" && build

      '
    matcher: contains
    expected: 'Building project: webapp'
- id: fix-test-command
  title: Test Command Must Run Without Errors
  description: 'The ''test'' command requires TEST_DB environment variable.


    It should output:

    Running tests against test_database


    **What needs fixing?**

    - Is test command in PATH?

    - Is TEST_DB set and exported?


    Make it work!

    '
  hint: Check where test command is located, add to PATH, export TEST_DB
  validation:
    type: command-output
    command: 'source /home/learner/.bashrc && export PATH="$HOME/bin:$HOME/.local/bin:$HOME/tools:$PATH"
      && export TEST_DB=''test_database'' && test

      '
    matcher: contains
    expected: Running tests against test_database
- id: verify-persistence
  title: Configuration Must Persist
  description: 'Your fixes must be saved to .bashrc so they work in new shell sessions.


    **Verification:**

    A fresh bash shell should:

    - Find all three commands (deploy, build, test)

    - Have all required variables set correctly


    Test with:

    bash -c ''deploy''

    bash -c ''build''

    bash -c ''export TEST_DB=test_database && test''


    All should work!

    '
  hint: Ensure all fixes are saved in .bashrc with proper exports
  validation:
    type: command-output
    command: 'cat ~/.bashrc | grep -E "(export PATH|export.*PROJECT_NAME|export.*DEPLOY_ENV|export.*SERVER_URL|export.*BUILD_OUTPUT)"
      | wc -l

      '
    matcher: contains
    expected: '5'
- id: final-validation
  title: Complete System Test
  description: '**Final Challenge:**


    Run this complete test to verify everything works:


    bash << ''TEST_SCRIPT''

    source ~/.bashrc

    export TEST_DB=''test_database''


    echo "=== Testing deploy ==="

    deploy || exit 1


    echo -e "\n=== Testing build ==="

    build || exit 1


    echo -e "\n=== Testing test ==="

    test || exit 1


    echo -e "\nâœ“ All systems operational!"

    TEST_SCRIPT


    If any command fails or shows wrong output, keep debugging!


    **Think like a DevOps engineer:**

    - Read error messages carefully

    - Test each component individually

    - Check PATH with: echo $PATH

    - Check variables with: env | grep VAR_NAME

    - Check permissions with: ls -l

    - Test scripts directly: /full/path/to/script


    You have all the skills needed - combine them!

    '
  hint: 'Complete checklist:

    â˜ .bashrc has export for PROJECT_NAME

    â˜ .bashrc has export for DEPLOY_ENV

    â˜ .bashrc has export for SERVER_URL (not SERVER_URl!)

    â˜ .bashrc has export for BUILD_OUTPUT with double quotes

    â˜ PATH includes: $HOME/bin:$HOME/.local/bin:$HOME/tools

    â˜ PATH uses : not ; as separator

    â˜ build script has execute permission

    â˜ TEST_DB is exported

    '
  validation:
    type: command-output
    command: 'cat > /tmp/fixed_bashrc << ''FIXED''

      export PROJECT_NAME=''webapp''

      export PATH="$HOME/bin:$HOME/.local/bin:$HOME/tools:$PATH"

      export DEPLOY_ENV=''development''

      export SERVER_URL=''localhost:8080''

      export BUILD_OUTPUT="$HOME/build"

      export TEST_DB=''test_database''

      FIXED

      chmod +x /home/learner/.local/bin/build

      source /tmp/fixed_bashrc && deploy 2>&1 && build 2>&1 && test 2>&1 | grep -c
      "Running tests"

      '
    matcher: contains
    expected: '1'
completion:
  message: 'ðŸŽ¯ EXPERT-LEVEL CHALLENGE COMPLETED! ðŸŽ¯


    You successfully debugged a complex environment with multiple interrelated issues:


    **Issues You Solved:**

    âœ“ Fixed PATH with wrong separator (semicolon vs colon)

    âœ“ Added missing directory to PATH (tools/)

    âœ“ Corrected typo in variable name (SERVER_URl â†’ SERVER_URL)

    âœ“ Changed single quotes to double quotes for variable expansion

    âœ“ Added missing ''export'' statements

    âœ“ Fixed missing execute permissions

    âœ“ Set required TEST_DB variable

    âœ“ Made all changes persistent in .bashrc


    **Skills Demonstrated:**

    - Systematic debugging methodology

    - Environment variable troubleshooting

    - PATH manipulation

    - Permission management

    - Quote handling

    - Script debugging

    - Reading error messages

    - Testing and validation


    **Real-World Application:**

    This scenario mirrors actual DevOps challenges where you inherit

    broken configurations and must systematically debug them.


    You''ve proven you can handle production environment issues!

    '
  xp: 750
  unlocks:
  - linux/week6/advanced-filesystem-internals
  - linux/week11/shell-scripting-fundamentals
