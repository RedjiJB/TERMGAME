mission:
  id: "linux/week10/compression-basics-beginner"
  title: "Introduction to File Compression"
  difficulty: beginner
  description: "Learn to compress and decompress files using common Linux compression tools"
  estimated_time: 20
  tags:
    - linux
    - compression
    - gzip
    - bzip2
    - tar
    - beginner
    - week10
    - cst8207

environment:
  image: "ubuntu:22.04"
  workdir: "/home/learner"
  setup:
    - "apt-get update -qq && apt-get install -y -qq bzip2 gzip tar file"
    - "mkdir -p /home/learner/files /home/learner/archive"
    - |
      echo "This is a test file with some content that will compress well because compression works best with repetitive data." > /home/learner/files/test1.txt
    - |
      echo "Another test file with different content. Compression ratios depend on the data patterns and redundancy in the original file." > /home/learner/files/test2.txt
    - |
      for i in {1..100}; do echo "Log entry $i: System running normally at $(date)" >> /home/learner/files/logfile.log; done
    - "dd if=/dev/zero of=/home/learner/files/largefile.dat bs=1M count=10 2>/dev/null"

steps:
  - id: "understand-compression"
    title: "What is File Compression?"
    description: |
      **File Compression: Reducing File Size**

      Compression reduces file size by removing redundancy in data.

      **Why Compress Files?**
      - Save disk space
      - Faster file transfers
      - Reduce bandwidth usage
      - Archive old data efficiently
      - Backup storage optimization

      **Common Linux Compression Tools:**

      1. **gzip** - Fast, good compression, most common
         Extension: .gz
         Command: gzip / gunzip

      2. **bzip2** - Slower, better compression
         Extension: .bz2
         Command: bzip2 / bunzip2

      3. **xz** - Best compression, slowest
         Extension: .xz
         Command: xz / unxz

      4. **tar** - Archiving (combines files), often used with compression
         Extension: .tar, .tar.gz, .tar.bz2
         Command: tar

      **Check file sizes:**
      ls -lh files/

      Note the sizes - we'll compress these files and compare!
    hint: "Type: ls -lh files/"
    validation:
      type: "command-output"
      command: "ls -lh /home/learner/files/ | head -1"
      matcher: "contains"
      expected: "total"

  - id: "gzip-compress"
    title: "Compress with gzip"
    description: |
      **Using gzip:**

      gzip is the most commonly used compression tool on Linux.

      **Compress a file:**
      gzip files/test1.txt

      This creates: files/test1.txt.gz
      Original file is REMOVED (replaced with compressed version)

      **Important:**
      - Original file is deleted by default
      - New file has .gz extension
      - Use -k to keep original: gzip -k file

      **Check compression ratio:**
      Before compressing, note the size:
      ls -lh files/test1.txt

      Then compress:
      gzip files/test1.txt

      Check new size:
      ls -lh files/test1.txt.gz

      You should see significant size reduction!
    hint: "Type: gzip files/test1.txt"
    validation:
      type: "file-exists"
      path: "/home/learner/files/test1.txt.gz"

  - id: "gzip-decompress"
    title: "Decompress with gunzip"
    description: |
      **Decompressing gzip Files:**

      Use gunzip to restore compressed files.

      **Decompress:**
      gunzip files/test1.txt.gz

      This restores: files/test1.txt
      Compressed file (.gz) is removed

      **Alternative commands:**
      gzip -d files/test1.txt.gz    # Same as gunzip
      gunzip -k files/test1.txt.gz  # Keep .gz file

      **View compressed file without extracting:**
      zcat files/test1.txt.gz       # Display contents
      zless files/test1.txt.gz      # Page through contents
      zgrep "pattern" file.gz       # Search in compressed file

      **Decompress test1.txt.gz:**
      gunzip files/test1.txt.gz

      Verify restoration:
      ls -lh files/test1.txt
    hint: "Type: gunzip files/test1.txt.gz"
    validation:
      type: "file-exists"
      path: "/home/learner/files/test1.txt"

  - id: "bzip2-compress"
    title: "Compress with bzip2"
    description: |
      **Using bzip2:**

      bzip2 provides better compression than gzip, but is slower.

      **When to use bzip2:**
      - When disk space is critical
      - For long-term archival
      - When compression ratio > speed
      - For large text files and logs

      **Compress with bzip2:**
      bzip2 files/test2.txt

      Creates: files/test2.txt.bz2

      **bzip2 commands:**
      bzip2 file         # Compress
      bunzip2 file.bz2   # Decompress
      bzip2 -d file.bz2  # Decompress (alternative)
      bzip2 -k file      # Keep original
      bzcat file.bz2     # View without extracting

      **Compress test2.txt:**
      bzip2 files/test2.txt

      Check the result:
      ls -lh files/test2.txt.bz2
    hint: "Type: bzip2 files/test2.txt"
    validation:
      type: "file-exists"
      path: "/home/learner/files/test2.txt.bz2"

  - id: "compare-compression"
    title: "Compare Compression Methods"
    description: |
      **Comparing gzip vs bzip2:**

      Let's compress the same file with both methods and compare.

      **Compress logfile with both:**

      1. Make a backup first:
         cp files/logfile.log files/logfile_backup.log

      2. Compress with gzip:
         gzip -k files/logfile.log
         ls -lh files/logfile.log.gz

      3. Compress with bzip2:
         bzip2 -k files/logfile_backup.log
         ls -lh files/logfile_backup.log.bz2

      **Compare:**
      ls -lh files/logfile*

      You should see:
      - Original file
      - .gz version (faster, larger)
      - .bz2 version (slower, smaller)

      **Typical compression ratios:**
      - gzip: 60-70% reduction
      - bzip2: 70-80% reduction
      - xz: 75-85% reduction (not shown)

      **Create both compressed versions:**
      cp files/logfile.log files/logfile_backup.log
      gzip -k files/logfile.log
      bzip2 -k files/logfile_backup.log
    hint: "Follow the commands in order to create both compressed versions"
    validation:
      type: "command-output"
      command: "ls /home/learner/files/ | grep -E 'logfile.*\\.(gz|bz2)' | wc -l"
      matcher: "contains"
      expected: "2"

  - id: "tar-basics"
    title: "Introduction to tar Archives"
    description: |
      **tar: Tape Archive**

      tar combines multiple files into a single archive.

      **Key Concept:**
      tar does NOT compress by default - it just bundles files!

      **Basic tar syntax:**
      tar [options] archive.tar files...

      **Essential options:**
      -c  Create archive
      -x  Extract archive
      -t  List contents
      -f  Specify filename
      -v  Verbose (show progress)

      **Create a simple tar archive:**
      tar -cf archive/backup.tar files/test1.txt files/test2.txt

      -c = create
      -f = filename

      **List archive contents:**
      tar -tf archive/backup.tar

      -t = list contents

      **Create the archive:**
      tar -cf archive/backup.tar files/test1.txt files/test2.txt

      Then list it:
      tar -tf archive/backup.tar
    hint: "Type: tar -cf archive/backup.tar files/test1.txt files/test2.txt"
    validation:
      type: "file-exists"
      path: "/home/learner/archive/backup.tar"

  - id: "tar-with-compression"
    title: "Combine tar with Compression"
    description: |
      **tar + Compression = Powerful Archiving**

      tar can compress while archiving using these options:

      **tar with gzip:**
      tar -czf archive.tar.gz files/
      -z = use gzip compression

      **tar with bzip2:**
      tar -cjf archive.tar.bz2 files/
      -j = use bzip2 compression

      **tar with xz:**
      tar -cJf archive.tar.xz files/
      -J = use xz compression

      **Memory aid:**
      - -z looks like "zip" â†’ gzip
      - -j is for "bzip" (j â‰ˆ second letter)
      - -J is uppercase â†’ XZ

      **Create compressed archive:**
      tar -czf archive/files_backup.tar.gz files/

      This creates a single compressed archive of the entire files/ directory!

      **Compare sizes:**
      ls -lh archive/

      tar.gz should be much smaller than .tar

      **Create the compressed archive:**
      tar -czf archive/files_backup.tar.gz files/
    hint: "Type: tar -czf archive/files_backup.tar.gz files/"
    validation:
      type: "file-exists"
      path: "/home/learner/archive/files_backup.tar.gz"

  - id: "extract-tar"
    title: "Extract tar Archives"
    description: |
      **Extracting Archives:**

      Use -x (extract) instead of -c (create).

      **Extract tar archive:**
      tar -xf archive.tar

      **Extract tar.gz archive:**
      tar -xzf archive.tar.gz

      Or let tar auto-detect compression:
      tar -xf archive.tar.gz  # Works automatically!

      **Extract to specific directory:**
      tar -xf archive.tar -C /path/to/directory

      **Extract single file:**
      tar -xf archive.tar path/to/file

      **View before extracting:**
      tar -tzf archive.tar.gz

      **Practice extraction:**

      1. Create test directory:
         mkdir archive/extracted

      2. Extract compressed archive:
         tar -xzf archive/files_backup.tar.gz -C archive/extracted

      3. Verify:
         ls -R archive/extracted/

      You should see all files from files/ directory!
    hint: "Type: mkdir archive/extracted && tar -xzf archive/files_backup.tar.gz -C archive/extracted"
    validation:
      type: "command-output"
      command: "mkdir -p /home/learner/archive/extracted && tar -xzf /home/learner/archive/files_backup.tar.gz -C /home/learner/archive/extracted && ls /home/learner/archive/extracted/files/ | wc -l"
      matcher: "regex"
      expected: "[3-9]"

  - id: "file-command"
    title: "Identify File Types"
    description: |
      **The file Command:**

      Identify file types, including compressed files.

      **Usage:**
      file filename

      **Detects:**
      - Compression type (gzip, bzip2, xz)
      - Archive type (tar)
      - Text vs binary
      - Executable files
      - Image formats
      - And much more!

      **Examples:**

      Check compressed files:
      file files/logfile.log.gz

      Output: "gzip compressed data"

      file files/logfile_backup.log.bz2

      Output: "bzip2 compressed data"

      file archive/files_backup.tar.gz

      Output: "gzip compressed data"

      **Try it on various files:**
      file files/*
      file archive/*

      **Identify all files in archive directory:**
      file archive/*

      This helps you know which decompression tool to use!
    hint: "Type: file archive/*"
    validation:
      type: "command-output"
      command: "file /home/learner/archive/backup.tar | grep -i tar"
      matcher: "contains"
      expected: "tar"

  - id: "compression-levels"
    title: "Compression Levels"
    description: |
      **Adjusting Compression:**

      Both gzip and bzip2 support compression levels 1-9.

      **Compression level trade-offs:**
      - Level 1: Fastest, least compression
      - Level 9: Slowest, most compression
      - Default: Level 6 (good balance)

      **gzip levels:**
      gzip -1 file.txt    # Fast compression
      gzip -6 file.txt    # Default
      gzip -9 file.txt    # Maximum compression

      **bzip2 levels:**
      bzip2 -1 file.txt   # Fast
      bzip2 -9 file.txt   # Maximum (default is -9)

      **When to use different levels:**
      - Level 1-3: Temporary files, frequent access
      - Level 6: General use (default)
      - Level 9: Long-term archival, rarely accessed

      **Test compression levels:**

      Create copies:
      cp files/largefile.dat files/large1.dat
      cp files/largefile.dat files/large9.dat

      Compress with different levels:
      gzip -1 files/large1.dat
      gzip -9 files/large9.dat

      Compare:
      ls -lh files/large*.dat.gz

      Notice the size difference!
    hint: "Copy files and compress with different levels to see the difference"
    validation:
      type: "command-output"
      command: "cp /home/learner/files/largefile.dat /home/learner/files/large1.dat && gzip -1 /home/learner/files/large1.dat && ls /home/learner/files/large1.dat.gz"
      matcher: "contains"
      expected: "large1.dat.gz"

completion:
  message: |
    ðŸŽ‰ COMPRESSION BASICS MASTERED! ðŸŽ‰

    You've learned the fundamentals of file compression in Linux!

    **What You've Learned:**

    âœ“ File compression concepts and benefits
    âœ“ gzip compression and decompression
    âœ“ bzip2 for better compression ratios
    âœ“ Comparing compression methods
    âœ“ tar for archiving multiple files
    âœ“ Combining tar with compression
    âœ“ Extracting archives
    âœ“ Identifying file types with file command
    âœ“ Compression levels (1-9)

    **Compression Tools Summary:**

    **gzip/gunzip** (.gz)
    - Fast compression
    - Good for frequently accessed files
    - Commands: gzip, gunzip, zcat, zgrep

    **bzip2/bunzip2** (.bz2)
    - Better compression
    - Good for archival
    - Commands: bzip2, bunzip2, bzcat

    **tar** (.tar, .tar.gz, .tar.bz2)
    - Combines multiple files
    - Often used with compression
    - Key options: -c, -x, -t, -z, -j, -f, -v

    **Quick Reference:**

    Compress:
    gzip file.txt              â†’ file.txt.gz
    bzip2 file.txt             â†’ file.txt.bz2
    tar -czf archive.tar.gz files/

    Decompress:
    gunzip file.txt.gz         â†’ file.txt
    bunzip2 file.txt.bz2       â†’ file.txt
    tar -xzf archive.tar.gz

    View:
    zcat file.txt.gz           (gzip)
    bzcat file.txt.bz2         (bzip2)
    tar -tzf archive.tar.gz    (list tar contents)

    **Best Practices:**
    â˜‘ Use -k to keep original files
    â˜‘ Use tar for multiple files
    â˜‘ Choose compression based on needs (speed vs size)
    â˜‘ Test extraction before deleting originals
    â˜‘ Use absolute paths in scripts

    **Common Patterns:**
    Backup:  tar -czf backup_$(date +%Y%m%d).tar.gz /data/
    Extract: tar -xzf backup.tar.gz -C /restore/
    List:    tar -tzf backup.tar.gz | less

    EXCELLENT WORK!

    Next: Learn advanced compression techniques and automation!
  xp: 200
  unlocks:
    - "linux/week10/compression-advanced"
    - "linux/week10/cron-advanced"
