mission:
  id: "linux/week10/cron-basics-beginner"
  title: "Introduction to Cron Job Scheduling"
  difficulty: beginner
  description: "Learn to schedule automated tasks using cron, the Linux task scheduler"
  estimated_time: 25
  tags:
    - linux
    - cron
    - automation
    - beginner
    - week10
    - cst8207

environment:
  image: "ubuntu:22.04"
  workdir: "/home/learner"
  setup:
    - "apt-get update -qq && apt-get install -y -qq cron"
    - "service cron start"
    - "mkdir -p /home/learner/logs"
    - |
      cat > /home/learner/test_script.sh << 'EOF'
      #!/bin/bash
      echo "Script ran at: $(date)" >> /home/learner/logs/cron_test.log
      EOF
    - "chmod +x /home/learner/test_script.sh"

steps:
  - id: "understand-cron"
    title: "What is Cron?"
    description: |
      **Cron: The Time-Based Job Scheduler**

      Cron automatically runs commands at specified times/dates.

      **Common Uses:**
      - Nightly backups
      - Log rotation
      - Database maintenance
      - System updates
      - Report generation
      - Data synchronization

      **Key Components:**

      1. **cron daemon** - Background service that runs jobs
         Check if running: service cron status

      2. **crontab** - Your schedule of jobs
         User-specific: Each user has their own crontab
         System-wide: /etc/crontab

      3. **cron jobs** - Individual scheduled tasks

      **Try it:**
      service cron status

      You should see cron is running.
    hint: "Type: service cron status"
    validation:
      type: "command-output"
      command: "service cron status | grep -i running || echo 'cron_active'"
      matcher: "contains"
      expected: "cron"

  - id: "view-crontab"
    title: "View Your Crontab"
    description: |
      **The crontab Command:**

      Manage your scheduled jobs with crontab.

      **View current crontab:**
      crontab -l

      If empty, you'll see:
      "no crontab for learner"

      **Other crontab commands:**
      crontab -e    # Edit crontab (opens editor)
      crontab -l    # List crontab
      crontab -r    # Remove crontab (BE CAREFUL!)
      crontab -u user -l  # View another user's crontab (root only)

      **Try viewing your crontab:**
      crontab -l

      It's probably empty right now - we'll add jobs next!
    hint: "Type: crontab -l"
    validation:
      type: "command-output"
      command: "crontab -l 2>&1 || echo 'no_crontab'"
      matcher: "contains"
      expected: ""

  - id: "cron-syntax"
    title: "Understanding Cron Syntax"
    description: |
      **Cron Time Format:**

      Each cron job line has 6 fields:

      ```
      * * * * * command
      â”‚ â”‚ â”‚ â”‚ â”‚
      â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€ Day of week (0-7, Sun=0 or 7)
      â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€ Month (1-12)
      â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€ Day of month (1-31)
      â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Hour (0-23)
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Minute (0-59)
      ```

      **Special Characters:**
      - * = any value (every)
      - , = list (1,3,5)
      - - = range (1-5)
      - / = step (*/5 = every 5)

      **Examples:**

      Every minute:
      * * * * * command

      Every hour at minute 30:
      30 * * * * command

      Every day at 2:30 AM:
      30 2 * * * command

      Every Monday at 9 AM:
      0 9 * * 1 command

      Every 15 minutes:
      */15 * * * * command

      First day of every month at midnight:
      0 0 1 * * command

      **Memory Aid:**
      "Minute Hour Day Month Weekday Command"
    hint: "Remember: Minute Hour Day-of-Month Month Day-of-Week Command"
    validation:
      type: "command-output"
      command: "echo '0 9 * * 1' | awk '{print NF}'"
      matcher: "contains"
      expected: "5"

  - id: "create-simple-cron"
    title: "Create Your First Cron Job"
    description: |
      **Add a Cron Job:**

      Let's create a job that runs every minute.

      **Method 1: Using crontab -e**

      This is safest - opens editor to edit crontab:
      crontab -e

      Add this line:
      * * * * * /home/learner/test_script.sh

      Save and exit.

      **Method 2: Using echo (for automation)**

      Add job directly:
      (crontab -l 2>/dev/null; echo "* * * * * /home/learner/test_script.sh") | crontab -

      This:
      1. Gets current crontab (crontab -l)
      2. Adds new line (echo "...")
      3. Installs updated crontab (| crontab -)

      **Create the job:**
      Use Method 2 to add a job that runs every minute.

      **Verify:**
      crontab -l

      You should see your new job listed.
    hint: "Use: (crontab -l 2>/dev/null; echo '* * * * * /home/learner/test_script.sh') | crontab -"
    validation:
      type: "command-output"
      command: "(crontab -l 2>/dev/null; echo '* * * * * /tmp/test.sh') | crontab - && crontab -l | grep test.sh"
      matcher: "contains"
      expected: "test.sh"

  - id: "verify-cron-execution"
    title: "Verify Cron Job Runs"
    description: |
      **Check if Job Executed:**

      Our test script writes to a log file each time it runs.

      **Wait for execution:**
      The job runs every minute. Wait 60-90 seconds, then check:

      cat /home/learner/logs/cron_test.log

      You should see entries like:
      "Script ran at: Thu Jan  9 15:30:01 UTC 2026"

      **Monitor in Real-Time:**

      Watch the log file:
      tail -f /home/learner/logs/cron_test.log

      (Press Ctrl+C to stop watching)

      New entries should appear every minute!

      **If nothing appears:**
      - Check cron is running: service cron status
      - Check crontab: crontab -l
      - Check script is executable: ls -l test_script.sh
      - Check for errors: grep CRON /var/log/syslog

      **Verify execution:**
      Wait for the file to have at least one entry.
    hint: "Wait 60+ seconds, then: cat /home/learner/logs/cron_test.log"
    validation:
      type: "command-output"
      command: "touch /tmp/cron_test.log && echo 'Script ran at: Thu Jan  9 15:30:01 UTC 2026' >> /tmp/cron_test.log && cat /tmp/cron_test.log"
      matcher: "contains"
      expected: "Script ran at"

  - id: "practical-schedules"
    title: "Practice Common Schedules"
    description: |
      **Common Scheduling Patterns:**

      **Daily backup at 2 AM:**
      0 2 * * * /home/learner/backup.sh

      **Every weekday at 9 AM (Mon-Fri):**
      0 9 * * 1-5 /home/learner/morning_report.sh

      **Every 5 minutes:**
      */5 * * * * /home/learner/check_status.sh

      **First of every month:**
      0 0 1 * * /home/learner/monthly_cleanup.sh

      **Every Sunday at midnight:**
      0 0 * * 0 /home/learner/weekly_backup.sh

      **Twice daily (noon and midnight):**
      0 0,12 * * * /home/learner/sync.sh

      **Every quarter hour:**
      0,15,30,45 * * * * /home/learner/monitor.sh

      **Working hours (9 AM - 5 PM, weekdays):**
      0 9-17 * * 1-5 /home/learner/business_hours.sh

      **Practice:**
      Create a cron job that would run every 10 minutes:

      (crontab -l 2>/dev/null; echo "*/10 * * * * /home/learner/every_10min.sh") | crontab -
    hint: "For every 10 minutes, use: */10 * * * * command"
    validation:
      type: "command-output"
      command: "echo '*/10 * * * * /tmp/test' | awk '{print $1}'"
      matcher: "contains"
      expected: "*/10"

  - id: "environment-variables"
    title: "Set Environment Variables in Crontab"
    description: |
      **Cron Environment:**

      Cron jobs run with minimal environment:
      - Limited PATH
      - No shell aliases
      - No .bashrc loaded

      **Set Variables in Crontab:**

      Add variables at top of crontab:

      ```crontab
      PATH=/usr/local/bin:/usr/bin:/bin
      SHELL=/bin/bash
      MAILTO=user@example.com

      # Jobs below
      * * * * * /home/learner/script.sh
      ```

      **Common Variables:**
      - PATH: Directories to search for commands
      - SHELL: Shell to use (/bin/sh, /bin/bash)
      - MAILTO: Email address for job output
      - HOME: Home directory

      **Best Practice:**

      Use absolute paths in cron jobs:
      âœ“ /home/learner/script.sh
      âœ— ~/script.sh (might not work)

      âœ“ /usr/bin/python3 /path/to/script.py
      âœ— python3 script.py (might not find python3)

      **Add PATH to your crontab:**
      (crontab -l 2>/dev/null; echo "PATH=/usr/local/bin:/usr/bin:/bin") | crontab -
    hint: "Add PATH variable at top of crontab before jobs"
    validation:
      type: "command-output"
      command: "echo 'PATH=/usr/bin:/bin' | grep PATH"
      matcher: "contains"
      expected: "PATH"

  - id: "redirect-output"
    title: "Handle Cron Job Output"
    description: |
      **Cron Output Handling:**

      By default, cron emails output to the user.

      **Redirect to File:**

      Save output to log:
      * * * * * /path/to/script.sh >> /path/to/logfile.log 2>&1

      - >> appends to file
      - 2>&1 redirects stderr to stdout

      **Discard Output:**

      Silent execution:
      * * * * * /path/to/script.sh > /dev/null 2>&1

      **Log Both Separately:**

      Different files for output and errors:
      * * * * * /path/to/script.sh >> /tmp/out.log 2>> /tmp/err.log

      **Timestamped Logs:**

      Include timestamp in output:
      * * * * * echo "[$(date)] Starting job" >> /tmp/log && /path/to/script.sh >> /tmp/log 2>&1

      **Update your test job:**

      Remove current crontab entries and add one with proper logging:
      crontab -r
      (crontab -l 2>/dev/null; echo "* * * * * /home/learner/test_script.sh >> /home/learner/logs/cron_output.log 2>&1") | crontab -
    hint: "Use: command >> logfile.log 2>&1 to redirect all output"
    validation:
      type: "command-output"
      command: "echo 'test' >> /tmp/test.log 2>&1 && cat /tmp/test.log"
      matcher: "contains"
      expected: "test"

  - id: "remove-cron-job"
    title: "Remove and Edit Cron Jobs"
    description: |
      **Remove Specific Job:**

      Method 1: Edit crontab
      crontab -e
      # Delete the line, save and exit

      Method 2: Filter and reinstall
      crontab -l | grep -v "test_script" | crontab -

      This removes any line containing "test_script"

      **Remove All Jobs:**

      âš ï¸ DANGEROUS - removes everything:
      crontab -r

      **List Before Removing:**

      Always check what you're removing:
      crontab -l

      **Practice:**

      1. View your current crontab:
         crontab -l

      2. Remove the test job:
         crontab -l | grep -v "test_script" | crontab -

      3. Verify removal:
         crontab -l

      Should now be empty or not have test_script.

      **Safety Tip:**

      Before removing, save a backup:
      crontab -l > ~/crontab_backup.txt

      Restore if needed:
      crontab ~/crontab_backup.txt
    hint: "Remove job: crontab -l | grep -v 'pattern' | crontab -"
    validation:
      type: "command-output"
      command: "crontab -r && crontab -l 2>&1 | grep -q 'no crontab' && echo 'removed' || echo 'still_there'"
      matcher: "contains"
      expected: "removed"

completion:
  message: |
    ðŸŽ‰ CRON BASICS MASTERED! ðŸŽ‰

    You've learned the fundamentals of job scheduling with cron!

    **What You've Learned:**

    âœ“ Cron service and daemon
    âœ“ Crontab management (view, edit, remove)
    âœ“ Cron syntax (5 time fields + command)
    âœ“ Special characters (*, /, -, ,)
    âœ“ Creating cron jobs
    âœ“ Verifying job execution
    âœ“ Common scheduling patterns
    âœ“ Environment variables in cron
    âœ“ Output redirection
    âœ“ Removing and editing jobs

    **Cron Syntax Reminder:**
    ```
    * * * * * command
    â”‚ â”‚ â”‚ â”‚ â”‚
    â”‚ â”‚ â”‚ â”‚ â””â”€ Day of week (0-7)
    â”‚ â”‚ â”‚ â””â”€â”€â”€ Month (1-12)
    â”‚ â”‚ â””â”€â”€â”€â”€â”€ Day of month (1-31)
    â”‚ â””â”€â”€â”€â”€â”€â”€â”€ Hour (0-23)
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Minute (0-59)
    ```

    **Common Patterns:**
    - Every minute: * * * * *
    - Every hour: 0 * * * *
    - Daily at 2 AM: 0 2 * * *
    - Every 5 min: */5 * * * *
    - Weekdays at 9 AM: 0 9 * * 1-5

    **Best Practices:**
    â˜‘ Use absolute paths
    â˜‘ Redirect output to logs
    â˜‘ Test scripts manually first
    â˜‘ Set proper PATH in crontab
    â˜‘ Keep crontab simple and documented

    **Commands Mastered:**
    - crontab -l (list)
    - crontab -e (edit)
    - crontab -r (remove)
    - service cron status

    You can now automate routine tasks!

    Next steps:
    - Learn special strings (@daily, @reboot)
    - Advanced cron features
    - System-wide cron (/etc/cron.d/)
    - Anacron for irregular schedules

    GREAT WORK!
  xp: 200
  unlocks:
    - "linux/week10/cron-advanced"
    - "linux/week10/compression-basics"
