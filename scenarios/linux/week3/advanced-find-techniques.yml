mission:
  id: "advanced-find-techniques"
  title: "Advanced File Finding and Search Techniques"
  difficulty: "advanced"
  description: |
    Master advanced find command techniques, complex search patterns, and efficient
    file location strategies. Learn to combine find with exec, xargs, and regex.

    Become a file-finding expert!
  estimated_time: "45 minutes"
  xp_reward: 500
  tags:
    - "find"
    - "search"
    - "advanced"
    - "regex"
    - "week3"

environment:
  runtime: "docker"
  base_image: "ubuntu:22.04"
  setup: |
    apt-get update && apt-get install -y \
      findutils \
      coreutils

steps:
  - id: "find-advanced-tests"
    description: |
      **Advanced find Tests**

      ```bash
      # Time-based
      find -mtime -7        # Modified in last 7 days
      find -mtime +30       # Modified more than 30 days ago
      find -newer file      # Newer than file

      # Size-based
      find -size +100M      # Larger than 100MB
      find -size -1k        # Smaller than 1KB
      find -empty           # Empty files/dirs

      # Combining tests
      find -name "*.log" -size +10M      # AND
      find -name "*.txt" -o -name "*.md" # OR
      find \! -name "*.bak"              # NOT
      ```

      **Task:** Practice advanced tests.

      ```bash
      mkdir -p ~/advanced_find
      cd ~/advanced_find

      # Create test files
      touch old_file.txt
      touch -t 202301010000 old_file.txt
      dd if=/dev/zero of=large.bin bs=1M count=5 2>/dev/null
      touch small.txt
      mkdir empty_dir

      echo "Advanced find Tests" > find_tests.txt
      echo "===================" >> find_tests.txt
      echo "" >> find_tests.txt

      echo "Files larger than 1MB:" >> find_tests.txt
      find . -type f -size +1M >> find_tests.txt

      echo "" >> find_tests.txt
      echo "Empty files/directories:" >> find_tests.txt
      find . -empty >> find_tests.txt

      cat find_tests.txt
      ```
    hint: |
      Combine tests with -a (AND, default), -o (OR), or ! (NOT). Use parentheses
      for grouping: \( -name "*.txt" -o -name "*.md" \)
    validation:
      - type: "file-exists"
        path: "~/advanced_find/find_tests.txt"

  - id: "find-exec-xargs"
    description: |
      **find with -exec and xargs**

      **-exec method:**
      ```bash
      find . -name "*.txt" -exec cat {} \;
      find . -type f -exec chmod 644 {} \;
      find . -name "*.log" -exec gzip {} \;
      ```

      **xargs method (more efficient):**
      ```bash
      find . -name "*.txt" | xargs cat
      find . -name "*.txt" -print0 | xargs -0 rm
      ```

      **Task:** Use exec and xargs.

      ```bash
      mkdir -p batch_ops
      for i in {1..5}; do
        echo "Content $i" > batch_ops/file$i.txt
      done

      echo "find -exec and xargs" > exec_demo.txt
      echo "====================" >> exec_demo.txt
      echo "" >> exec_demo.txt

      echo "Using -exec to add prefix:" >> exec_demo.txt
      find batch_ops -name "*.txt" -exec sh -c 'echo "File: $(basename {})"' \; >> exec_demo.txt

      echo "" >> exec_demo.txt
      echo "Count lines in all files (xargs):" >> exec_demo.txt
      find batch_ops -name "*.txt" | xargs wc -l >> exec_demo.txt

      cat exec_demo.txt
      ```
    hint: |
      -exec runs command for each file. {} is replaced with filename. xargs is
      more efficient for large result sets. Use -print0 and xargs -0 for spaces.
    validation:
      - type: "file-exists"
        path: "~/advanced_find/exec_demo.txt"

  - id: "locate-and-which"
    description: |
      **Using locate and which**

      **locate (fast database search):**
      ```bash
      locate filename       # Search entire system
      locate -i pattern     # Case-insensitive
      locate -c pattern     # Count matches
      ```

      **which (find commands):**
      ```bash
      which ls              # Find ls command
      which -a python       # All instances
      ```

      **Task:** Use locate and which alternatives.

      ```bash
      echo "locate and which Alternatives" > locate_demo.txt
      echo "=============================" >> locate_demo.txt
      echo "" >> locate_demo.txt

      echo "Finding commands with which:" >> locate_demo.txt
      which bash >> locate_demo.txt
      which find >> locate_demo.txt
      which cat >> locate_demo.txt

      echo "" >> locate_demo.txt
      echo "Alternative to locate using find:" >> locate_demo.txt
      find /usr -name "ls" 2>/dev/null | head -5 >> locate_demo.txt

      cat locate_demo.txt
      ```
    hint: |
      locate is fast but uses a database (updatedb). which finds executables
      in PATH. For real-time search, use find.
    validation:
      - type: "file-exists"
        path: "~/advanced_find/locate_demo.txt"

  - id: "complex-scenarios"
    description: |
      **Complex Search Scenarios**

      ```bash
      # Find and clean old logs
      find /var/log -name "*.log" -mtime +30 -exec gzip {} \;

      # Find duplicate file names
      find . -type f -printf "%f\n" | sort | uniq -d

      # Find and organize by extension
      find . -type f -name "*.jpg" -exec mv {} images/ \;

      # Find world-writable files (security)
      find / -perm -002 -type f 2>/dev/null
      ```

      **Task:** Solve complex scenarios.

      ```bash
      mkdir -p scenarios/{images,docs,archives}
      touch scenarios/photo1.jpg scenarios/photo2.jpg
      touch scenarios/doc1.pdf scenarios/doc2.pdf
      touch scenarios/archive.zip

      echo "Complex Find Scenarios" > scenarios_demo.txt
      echo "======================" >> scenarios_demo.txt
      echo "" >> scenarios_demo.txt

      echo "Organizing files by type:" >> scenarios_demo.txt
      find scenarios -maxdepth 1 -name "*.jpg" -exec mv {} scenarios/images/ \; 2>/dev/null || true
      find scenarios -maxdepth 1 -name "*.pdf" -exec mv {} scenarios/docs/ \; 2>/dev/null || true
      echo "Files organized!" >> scenarios_demo.txt

      echo "Result:" >> scenarios_demo.txt
      find scenarios -type f >> scenarios_demo.txt

      cat scenarios_demo.txt
      ```

      **Congratulations!** You've mastered advanced find techniques!

      **You learned:**
      - Advanced find tests (time, size, type)
      - Using -exec and xargs efficiently
      - locate and which for quick searches
      - Complex real-world scenarios

      **Power user tips:**
      - Combine tests for precise results
      - Use xargs for efficiency
      - Test with -print before -exec
      - Use -print0 and -0 for special characters

      You can now find anything efficiently!
    hint: |
      Always test find commands with a dry run first. Replace -exec with -print
      to see what would be affected before making changes.
    validation:
      - type: "file-exists"
        path: "~/advanced_find/scenarios_demo.txt"
