mission:
  id: "linux/week4/io-redirection"
  title: "Input/Output Redirection"
  difficulty: intermediate
  description: "Master stdin, stdout, stderr, and file redirection in Linux"
  estimated_time: 30
  tags:
    - linux
    - redirection
    - io
    - week4
    - cst8207

environment:
  image: "ubuntu:22.04"
  workdir: "/home/learner"
  setup:
    - "mkdir -p /home/learner/work"
    - "echo 'Hello World' > /home/learner/work/input.txt"
    - "echo -e 'Line 1\nLine 2\nLine 3' > /home/learner/work/data.txt"

steps:
  - id: "stdout-redirect"
    title: "Redirect Standard Output"
    description: |
      Use > to redirect stdout (standard output) to a file.

      Create a file with output from echo:
      echo "Testing output redirection" > output.txt

      Then verify: cat output.txt
    hint: "Type: echo 'Testing output redirection' > output.txt && cat output.txt"
    validation:
      type: "command-output"
      command: "echo 'Testing output redirection' > /tmp/output.txt && cat /tmp/output.txt"
      matcher: "contains"
      expected: "Testing output redirection"

  - id: "append-output"
    title: "Append to Files with >>"
    description: |
      Use >> to append output to a file (doesn't overwrite).

      Append a new line to output.txt:
      echo "Second line" >> output.txt
      cat output.txt

      You should see both lines.
    hint: "Type: echo 'Second line' >> /tmp/output.txt && cat /tmp/output.txt"
    validation:
      type: "command-output"
      command: "echo 'First' > /tmp/test.txt && echo 'Second' >> /tmp/test.txt && wc -l < /tmp/test.txt"
      matcher: "contains"
      expected: "2"

  - id: "stdin-redirect"
    title: "Redirect Standard Input"
    description: |
      Use < to redirect stdin (standard input) from a file.

      Count lines in data.txt using input redirection:
      wc -l < work/data.txt

      This sends file contents as input to wc.
    hint: "Type: wc -l < /home/learner/work/data.txt"
    validation:
      type: "command-output"
      command: "wc -l < /home/learner/work/data.txt"
      matcher: "contains"
      expected: "3"

  - id: "stderr-redirect"
    title: "Redirect Standard Error (stderr)"
    description: |
      Use 2> to redirect stderr (file descriptor 2) separately from stdout.

      Try to list a non-existent file and redirect error:
      ls /nonexistent 2> error.log
      cat error.log

      The error message goes to error.log instead of your screen.
    hint: "Type: ls /nonexistent 2> /tmp/error.log && cat /tmp/error.log"
    validation:
      type: "command-output"
      command: "ls /nonexistent 2> /tmp/error.log && cat /tmp/error.log"
      matcher: "contains"
      expected: "cannot access"

  - id: "combine-stdout-stderr"
    title: "Redirect Both stdout and stderr"
    description: |
      Use 2>&1 to redirect stderr to wherever stdout is going.

      Capture both output and errors:
      ls /home /nonexistent > output.log 2>&1
      cat output.log

      Both successful output and errors go to output.log.
    hint: "Type: ls /home /nonexistent > /tmp/output.log 2>&1"
    validation:
      type: "command-output"
      command: "ls /home /nonexistent > /tmp/both.log 2>&1 && wc -l < /tmp/both.log"
      matcher: "contains"
      expected: "2"

  - id: "discard-output"
    title: "Discard Output with /dev/null"
    description: |
      /dev/null is a special file that discards everything written to it.

      Run a command and discard all output:
      ls / > /dev/null 2>&1

      Nothing appears on screen - both stdout and stderr are discarded.
    hint: "Type: ls / > /dev/null 2>&1 && echo 'Silent success'"
    validation:
      type: "command-output"
      command: "ls / > /dev/null 2>&1 && echo 'done'"
      matcher: "exact"
      expected: "done"

  - id: "here-document"
    title: "Here Documents (<<)"
    description: |
      Use << to provide multi-line input inline.

      Create a file with multiple lines:
      cat > multi.txt << EOF
      Line 1
      Line 2
      Line 3
      EOF

      Then verify: cat multi.txt
    hint: "Type the cat command with << EOF, add lines, then EOF"
    validation:
      type: "command-output"
      command: "cat > /tmp/multi.txt << 'EOF'\nLine 1\nLine 2\nLine 3\nEOF\nwc -l < /tmp/multi.txt"
      matcher: "contains"
      expected: "3"

completion:
  message: |
    Excellent! You've mastered I/O redirection:
    - > redirect stdout to file (overwrite)
    - >> append stdout to file
    - < redirect stdin from file
    - 2> redirect stderr to file
    - 2>&1 redirect stderr to stdout
    - /dev/null discard output
    - << here document (multi-line input)

    These are fundamental skills for shell scripting and command-line work!
  xp: 250
  unlocks:
    - "linux/week4/pipes-filters"
