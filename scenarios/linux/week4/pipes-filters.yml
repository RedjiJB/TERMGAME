mission:
  id: "linux/week4/pipes-filters"
  title: "Pipes and Command Chaining"
  difficulty: intermediate
  description: "Learn to chain commands together using pipes for powerful data processing"
  estimated_time: 30
  tags:
    - linux
    - pipes
    - filters
    - week4
    - cst8207

environment:
  image: "ubuntu:22.04"
  workdir: "/home/learner"
  setup:
    - "mkdir -p /home/learner/data"
    - "echo -e 'apple 5\nbanana 3\ncherry 8\ndate 2\nelder 6' > /home/learner/data/fruits.txt"
    - "echo -e 'John 85\nJane 92\nBob 78\nAlice 95\nCharlie 88' > /home/learner/data/scores.txt"
    - "seq 1 100 > /home/learner/data/numbers.txt"

steps:
  - id: "basic-pipe"
    title: "Basic Pipe Usage"
    description: |
      The pipe operator (|) sends the output of one command as input to another.

      List files and count them:
      ls /home | wc -l

      ls output goes to wc (word count) which counts lines.
    hint: "Type: ls /home | wc -l"
    validation:
      type: "command-output"
      command: "ls /home | wc -l"
      matcher: "contains"
      expected: "1"

  - id: "grep-filter"
    title: "Filter Output with grep"
    description: |
      Use grep to filter output for specific patterns.

      Find lines containing 'a' in fruits.txt:
      cat data/fruits.txt | grep 'a'

      This shows only lines with the letter 'a'.
    hint: "Type: cat data/fruits.txt | grep 'a'"
    validation:
      type: "command-output"
      command: "cat /home/learner/data/fruits.txt | grep 'a' | wc -l"
      matcher: "contains"
      expected: "4"

  - id: "sort-output"
    title: "Sort Command Output"
    description: |
      Use sort to order output alphabetically or numerically.

      Sort fruits alphabetically:
      cat data/fruits.txt | sort

      Use sort -r for reverse order, sort -n for numeric sort.
    hint: "Type: cat data/fruits.txt | sort"
    validation:
      type: "command-output"
      command: "cat /home/learner/data/fruits.txt | sort | head -n 1"
      matcher: "contains"
      expected: "apple"

  - id: "head-tail"
    title: "Select Lines with head and tail"
    description: |
      head shows first N lines, tail shows last N lines.

      Get the first 3 lines of sorted fruits:
      cat data/fruits.txt | sort | head -n 3

      This pipes through sort, then takes first 3 lines.
    hint: "Type: cat data/fruits.txt | sort | head -n 3"
    validation:
      type: "command-output"
      command: "cat /home/learner/data/fruits.txt | sort | head -n 3 | wc -l"
      matcher: "contains"
      expected: "3"

  - id: "cut-fields"
    title: "Extract Fields with cut"
    description: |
      cut extracts specific fields from text.

      Get only the fruit names (first field):
      cat data/fruits.txt | cut -d' ' -f1

      -d' ' sets delimiter to space, -f1 selects first field.
    hint: "Type: cat data/fruits.txt | cut -d' ' -f1"
    validation:
      type: "command-output"
      command: "cat /home/learner/data/fruits.txt | cut -d' ' -f1 | grep apple"
      matcher: "contains"
      expected: "apple"

  - id: "awk-fields"
    title: "Process Fields with awk"
    description: |
      awk is powerful for field processing.

      Print the last field (quantity) from fruits.txt:
      cat data/fruits.txt | awk '{print $NF}'

      $NF means "Number of Fields" - the last field.
      $1 is first field, $2 is second, etc.
    hint: "Type: cat data/fruits.txt | awk '{print $NF}'"
    validation:
      type: "command-output"
      command: "cat /home/learner/data/fruits.txt | awk '{print $NF}' | head -n 1"
      matcher: "contains"
      expected: "5"

  - id: "complex-pipeline"
    title: "Build a Complex Pipeline"
    description: |
      Combine multiple commands for advanced processing.

      Find students with scores above 85, sort by name:
      cat data/scores.txt | awk '$2 > 85' | sort

      This filters scores >85, then sorts the results.
    hint: "Type: cat data/scores.txt | awk '$2 > 85' | sort"
    validation:
      type: "command-output"
      command: "cat /home/learner/data/scores.txt | awk '$2 > 85' | wc -l"
      matcher: "contains"
      expected: "3"

  - id: "tee-command"
    title: "Split Output with tee"
    description: |
      tee sends output to both a file AND the next command.

      Save and display sorted numbers:
      cat data/numbers.txt | sort -n | tee sorted.txt | head -n 5

      This saves ALL to sorted.txt but displays only first 5 lines.
    hint: "Type: cat data/numbers.txt | sort -n | tee /tmp/sorted.txt | head -n 5"
    validation:
      type: "command-output"
      command: "seq 1 10 | tee /tmp/test.txt | wc -l"
      matcher: "contains"
      expected: "10"

completion:
  message: |
    Outstanding! You've mastered pipes and filters:
    - | (pipe) chains commands together
    - grep filters by pattern
    - sort orders output
    - head/tail select first/last lines
    - cut extracts specific fields
    - awk processes fields ($1, $2, $NF)
    - tee splits output to file and pipe

    Pipes are the Unix philosophy in action: small tools working together!
  xp: 300
  unlocks:
    - "linux/week4/file-permissions"
